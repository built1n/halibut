# -*- sh -*-
# Build script to build a test file in all Halibut formats.

module halibut

# Build a local binary of Halibut.
in halibut do make

# Run it on the standard test input file. This generates most outputs.
in halibut do ./build/halibut inputs/test.but

# Run it again with lots of extra options, to generate HTML Help
# Compiler input.
in halibut do mkdir htmlhelp
in halibut/htmlhelp do ../build/halibut --html ../inputs/test.but -Chtml-leaf-level:infinite -Chtml-leaf-contains-contents:false -Chtml-suppress-navlinks:true -Chtml-suppress-address:true -Chtml-contents-filename:index.html -Chtml-template-filename:%k.html -Chtml-template-fragment:%k -Chtml-mshtmlhelp-chm:output.chm -Chtml-mshtmlhelp-project:output.hhp -Chtml-mshtmlhelp-contents:output.hhc -Chtml-mshtmlhelp-index:output.hhk -Chtml-body-end:

# Delegate to Windows to compile the HTML Help file.
delegate windows
  in halibut/htmlhelp do hhc output.hhp; test -f output.chm
  return halibut/htmlhelp/output.chm
enddelegate

deliver halibut/output.txt $@
deliver halibut/*.html $@
deliver halibut/output.hlp $@
deliver halibut/output.cnt $@
deliver halibut/htmlhelp/output.chm $@
deliver halibut/output.1 $@
deliver halibut/output.ps $@
deliver halibut/output.pdf $@
deliver halibut/output.info* $@
